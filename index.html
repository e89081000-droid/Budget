<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <title>Budget Tracker</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <style>
              body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
                  header { background: #2c3e50; color: #fff; padding: 15px; text-align: center; }
                      .container { max-width: 900px; margin: auto; padding: 20px; }
                          h2 { margin-top: 20px; }
                              input, select, button {
                                    padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box;
                                        }
                                            button { background: #27ae60; color: #fff; border: none; cursor: pointer; }
                                                button:hover { background: #219150; }
                                                    .envelope { background: #fff; padding: 10px; margin: 10px 0; border-radius: 5px;
                                                                    display: flex; justify-content: space-between; }
                                                                        .charts { margin-top: 30px; }
                                                                            canvas { max-width: 100%; }
                                                                                @media (max-width: 600px) {
                                                                                      .envelope { flex-direction: column; align-items: flex-start; }
                                                                                          }
                                                                                            </style>
                                                                                            </head>
                                                                                            <body>
                                                                                              <header>
                                                                                                  <h1>Budget Tracker</h1>
                                                                                                    </header>
                                                                                                      <div class="container">
                                                                                                          <h2>Add Envelope</h2>
                                                                                                              <input id="envelopeName" placeholder="Envelope name">
                                                                                                                  <button onclick="addEnvelope()">Add Envelope</button>

                                                                                                                      <h2>Add Transaction</h2>
                                                                                                                          <input id="amount" type="number" placeholder="Amount">
                                                                                                                              <select id="type">
                                                                                                                                    <option value="income">Income</option>
                                                                                                                                          <option value="expense">Expense</option>
                                                                                                                                              </select>
                                                                                                                                                  <select id="envelopeSelect"></select>
                                                                                                                                                      <input id="date" type="date">
                                                                                                                                                          <button onclick="addTransaction()">Add Transaction</button>

                                                                                                                                                              <h2>Date Filter</h2>
                                                                                                                                                                  <label>From: <input id="fromDate" type="date"></label>
                                                                                                                                                                      <label>To: <input id="toDate" type="date"></label>
                                                                                                                                                                          <button onclick="applyFilter()">Apply Filter</button>

                                                                                                                                                                              <h2>Envelopes</h2>
                                                                                                                                                                                  <div id="envelopes"></div>

                                                                                                                                                                                      <h2>Totals</h2>
                                                                                                                                                                                          <p id="totals"></p>

                                                                                                                                                                                              <div class="charts">
                                                                                                                                                                                                    <h2>Spending by Envelope</h2>
                                                                                                                                                                                                          <canvas id="pieChart"></canvas>
                                                                                                                                                                                                                <h2>Income vs Spending</h2>
                                                                                                                                                                                                                      <canvas id="barChart"></canvas>
                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                              <script>
                                                                                                                                                                                                                                  let envelopes = JSON.parse(localStorage.getItem('envelopes')) || {};
                                                                                                                                                                                                                                      let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

                                                                                                                                                                                                                                          function saveData() {
                                                                                                                                                                                                                                                localStorage.setItem('envelopes', JSON.stringify(envelopes));
                                                                                                                                                                                                                                                      localStorage.setItem('transactions', JSON.stringify(transactions));
                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                              function addEnvelope() {
                                                                                                                                                                                                                                                                    const name = document.getElementById('envelopeName').value.trim();
                                                                                                                                                                                                                                                                          if (!name || envelopes[name]) return;
                                                                                                                                                                                                                                                                                envelopes[name] = 0;
                                                                                                                                                                                                                                                                                      saveData();
                                                                                                                                                                                                                                                                                            updateEnvelopeSelect();
                                                                                                                                                                                                                                                                                                  renderEnvelopes();
                                                                                                                                                                                                                                                                                                        updateCharts();
                                                                                                                                                                                                                                                                                                              document.getElementById('envelopeName').value = '';
                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                      function updateEnvelopeSelect() {
                                                                                                                                                                                                                                                                                                                            const select = document.getElementById('envelopeSelect');
                                                                                                                                                                                                                                                                                                                                  select.innerHTML = '';
                                                                                                                                                                                                                                                                                                                                        for (let name in envelopes) {
                                                                                                                                                                                                                                                                                                                                                const option = document.createElement('option');
                                                                                                                                                                                                                                                                                                                                                        option.value = name;
                                                                                                                                                                                                                                                                                                                                                                option.textContent = name;
                                                                                                                                                                                                                                                                                                                                                                        select.appendChild(option);
                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                      function addTransaction() {
                                                                                                                                                                                                                                                                                                                                                                                            const amount = parseFloat(document.getElementById('amount').value);
                                                                                                                                                                                                                                                                                                                                                                                                  const type = document.getElementById('type').value;
                                                                                                                                                                                                                                                                                                                                                                                                        const envelope = document.getElementById('envelopeSelect').value;
                                                                                                                                                                                                                                                                                                                                                                                                              const date = document.getElementById('date').value;
                                                                                                                                                                                                                                                                                                                                                                                                                    if (!amount || !envelope || !date) return;

                                                                                                                                                                                                                                                                                                                                                                                                                          transactions.push({ amount, type, envelope, date });
                                                                                                                                                                                                                                                                                                                                                                                                                                saveData();
                                                                                                                                                                                                                                                                                                                                                                                                                                      applyFilter(); // refresh view with filters
                                                                                                                                                                                                                                                                                                                                                                                                                                            document.getElementById('amount').value = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                  document.getElementById('date').value = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                          function applyFilter() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                const from = document.getElementById('fromDate').value;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const to = document.getElementById('toDate').value;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                            let filtered = transactions.filter(t => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (from && t.date < from) return false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (to && t.date > to) return false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Reset envelope balances
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (let name in envelopes) envelopes[name] = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            let totalIncome = 0, totalExpense = 0;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  filtered.forEach(t => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (t.type === 'income') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    envelopes[t.envelope] += t.amount;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              totalIncome += t.amount;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                envelopes[t.envelope] -= t.amount;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          totalExpense += t.amount;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              renderEnvelopes();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    renderTotals(totalIncome, totalExpense);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          updateCharts(totalIncome, totalExpense);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function renderEnvelopes() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const container = document.getElementById('envelopes');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              container.innerHTML = '';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    for (let name in envelopes) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const div = document.createElement('div');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    div.className = 'envelope';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            div.innerHTML = `<strong>${name}</strong><span>Balance: ${envelopes[name].toFixed(2)}</span>`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    container.appendChild(div);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function renderTotals(income, expense) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        document.getElementById('totals').textContent =
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                `Income: ${income.toFixed(2)} | Expenses: ${expense.toFixed(2)} | Net: ${(income - expense).toFixed(2)}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const pieCtx = document.getElementById('pieChart').getContext('2d');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const barCtx = document.getElementById('barChart').getContext('2d');

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const pieChart = new Chart(pieCtx, {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      type: 'pie',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  options: { responsive: true }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const barChart = new Chart(barCtx, {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type: 'bar',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      data: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              labels: ['Income', 'Expenses'],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      datasets: [{ label: 'Amount', data: [0, 0], backgroundColor: ['#27ae60','#c0392b'] }]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  options: { responsive: true }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          function updateCharts(income=0, expense=0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                pieChart.data.labels = Object.keys(envelopes);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      pieChart.data.datasets[0].data = Object.values(envelopes).map(v => v < 0 ? -v : 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            pieChart.data.datasets[0].backgroundColor = Object.keys(envelopes).map(() =>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    '#' + Math.floor(Math.random()*16777215).toString(16)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                pieChart.update();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      barChart.data.datasets[0].data = [income, expense];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            barChart.update();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Initialize
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        updateEnvelopeSelect();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            applyFilter();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </html>